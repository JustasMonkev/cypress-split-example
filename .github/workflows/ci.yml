name: ci

on: push

jobs:
  # example running all tests on a single machine
  test:
    runs-on: ubuntu-20.04
    strategy:
      matrix:
        environment: [desktop, mobile]
        test: [A1, A2, A3]
    steps:
      - name: Checkout 🛎
        uses: actions/checkout@v2

      - name: Install Dependencies 📦
        run: npm install

      - name: Run Cypress tests 🧪
        # https://github.com/cypress-io/github-action
        uses: cypress-io/github-action@v5

  # example running tests on multiple machines
  test-split:
    needs: prepare
    runs-on: ubuntu-20.04
    outputs:
      matrix: ${{ steps.prepare.outputs.matrix }}
    steps:
      # cache dependencies for reuse across chunks
      - name: Cache Dependencies 🎁
        uses: actions/cache@v2
        with:
          path: ~/.npm
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-

      - name: Install Dependencies 📦
        run: npm ci

      - name: Run Cypress tests 🧪
        # https://github.com/cypress-io/github-action
        uses: cypress-io/github-action@v5
        env:
          SPLIT: ${{ strategy.job-total }}
          SPLIT_INDEX: ${{ strategy.job-index }}

  # example to combine all splits into a single job
  combine:
    needs: prepare
    runs-on: ubuntu-20.04
    steps:
      # cache dependencies for reuse across chunks
      - name: Cache Dependencies 🎁
        uses: actions/cache@v2
        with:
          path: ~/.npm
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-

      - name: Combine Results 🤝
        run: |
          echo "Combining test results"
          # combine test results here

    # set the "test" job as a required job to reduce manual job selection
    needs: test
