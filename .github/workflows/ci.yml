name: ci
on: push
jobs:
  # example running all tests on a single machine
  test:
    runs-on: ubuntu-20.04
    strategy:
      matrix:
        environment: [desktop, mobile]
        test: [A1, A2, A3]
    steps:
      - name: Checkout ğŸ›
        uses: actions/checkout@v3

      - name: Run Cypress tests ğŸ§ª
        # https://github.com/cypress-io/github-action
        uses: cypress-io/github-action@v5

  test-split:
    runs-on: ubuntu-20.04
    needs: prepare
    steps:
      - name: Checkout ğŸ›
        uses: actions/checkout@v3

      - name: Install dependencies ğŸ”§
        run: npm ci

      - name: Run Cypress tests ğŸ§ª
        # https://github.com/cypress-io/github-action
        uses: cypress-io/github-action@v5
        with:
          spec: ${{ matrix.test }}
        env:
          CYPRESS_CACHE_FOLDER: ${{ runner.workspace }}/.cypress_cache
    strategy:
      fail-fast: false
      matrix:
        include:
          - environment: desktop
            test: A1
          - environment: desktop
            test: A2
          - environment: desktop
            test: A3
          - environment: mobile
            test: A1
          - environment: mobile
            test: A2
          - environment: mobile
            test: A3

  combine-results:
    needs: [test-split]
    if: always()
    runs-on: ubuntu-20.04
    steps:
      - name: Combine test results ğŸ¤
        uses: peter-evans/create-pull-request@v3.10.1
        with:
          commit-message: 'Combine test results'
          title: 'Combine test results'
          body: 'This is an automatic PR to combine test results.'
          branch: 'combine-results'
          base: 'main'